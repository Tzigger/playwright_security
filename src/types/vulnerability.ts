import { VulnerabilityCategory, VulnerabilitySeverity } from './enums';
import { Evidence } from './evidence';

/**
 * Represents a detected security vulnerability
 */
export interface Vulnerability {
  /** Unique identifier for this vulnerability instance */
  id: string;

  /** Category of the vulnerability */
  category: VulnerabilityCategory;

  /** Severity level */
  severity: VulnerabilitySeverity;

  /** Short, descriptive title */
  title: string;

  /** Detailed description of the vulnerability */
  description: string;

  /** URL where vulnerability was found */
  url?: string;

  /** Evidence supporting this finding */
  evidence: Evidence;

  /** Recommended remediation steps */
  remediation: string;

  /** Reference links for more information */
  references: string[];

  /** CWE (Common Weakness Enumeration) ID if applicable */
  cwe?: string;

  /** OWASP Top 10 reference if applicable */
  owasp?: string;

  /** CVE ID if applicable */
  cve?: string;

  /** CVSS score if calculated */
  cvss?: number;

  /** Timestamp when vulnerability was detected */
  timestamp: Date | number;

  /** Unique fingerprint for deduplication */
  fingerprint?: string;

  /** Related findings (e.g. duplicates or variations) */
  relatedFindings?: Vulnerability[];

  /** Confidence level of the detection (0-1) */
  confidence?: number;

  /** Whether this is a confirmed vulnerability or potential false positive */
  confirmed?: boolean;

  /** ID of the detector that found this vulnerability */
  detectorId?: string;

  /** Additional metadata */
  metadata?: VulnerabilityMetadata;
}

/**
 * Additional metadata for vulnerabilities
 */
export interface VulnerabilityMetadata {
  /** Scanner that detected this vulnerability */
  scannerId?: string;

  /** Scan session ID */
  scanId?: string;

  /** Whether this vulnerability was found in passive or active scanning */
  scanType?: 'passive' | 'active';

  /** Number of times this vulnerability was detected */
  occurrences?: number;

  /** Related vulnerabilities (by ID) */
  relatedVulnerabilities?: string[];

  /** Whether this vulnerability is exploitable */
  exploitable?: boolean;

  /** Exploitation difficulty */
  exploitationDifficulty?: 'low' | 'medium' | 'high';

  /** Business impact description */
  businessImpact?: string;

  /** Technical impact description */
  technicalImpact?: string;

  /** Affected components/modules */
  affectedComponents?: string[];

  /** Custom tags for categorization */
  tags?: string[];

  /** Any additional context */
  [key: string]: unknown;
}

/**
 * Vulnerability report containing multiple vulnerabilities
 */
export interface VulnerabilityReport {
  /** Report ID */
  id: string;

  /** Scan ID this report belongs to */
  scanId: string;

  /** List of vulnerabilities found */
  vulnerabilities: Vulnerability[];

  /** Report generation timestamp */
  timestamp: Date;

  /** Summary statistics */
  summary: VulnerabilitySummary;
}

/**
 * Summary statistics for vulnerabilities
 */
export interface VulnerabilitySummary {
  /** Total number of vulnerabilities */
  total: number;

  /** Count by severity */
  bySeverity: Record<VulnerabilitySeverity, number>;

  /** Count by category */
  byCategory: Record<VulnerabilityCategory, number>;

  /** Count by confirmation status */
  byConfirmation: {
    confirmed: number;
    potential: number;
  };

  /** Most common vulnerability category */
  mostCommonCategory?: VulnerabilityCategory;

  /** Highest severity found */
  highestSeverity?: VulnerabilitySeverity;

  /** Average confidence score */
  averageConfidence: number;
}
